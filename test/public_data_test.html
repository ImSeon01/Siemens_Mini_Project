<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공공데이터</title>
    <!--jQuery-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>

<body>
    <!--Div that will hold the pie chart-->
    <div id="chart_div"></div>

    <script>
        let tmps = [];
        $(function () {

            // 어제 날짜 구하기
            const today = new Date();
            const year = today.getFullYear();
            const month = (today.getMonth() + 1) < 10 ? '0' + (today.getMonth() + 1) : (today.getMonth() + 1);
            const date = today.getDate() - 1 < 10 ? '0' + (today.getDate() - 1) : (today.getDate() - 1);
            const base_date = year.toString() + month + date;

            // 어제 기온을 담을 배열
            
            // let times = new Array();
            // 단기예보 조회서비스
            for (let i = 2; i < 24; i += 3) {

                let base_time = (i < 10 ? '0' + i : i) + '00';
                let msg = '';
                $.ajax({
                    // 서비스를 요청할 url
                    url: "https://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getVilageFcst",
                    data: {
                        // 서비스키
                        serviceKey: "6SPFH0kJC57EY3tgIjMn7ZPrhX5UkJlauz0ErFzfD2gdu/HMVOrcHisBv6e3ctu5h8OD/o1ZN8LCOmgHg0h+eg==",
                        // 응답자료형식
                        dataType: "JSON",
                        // 조회를 원하는 날짜 YYYYMMDD 형식
                        base_date: base_date,
                        // 0200, 0500, 0800, 1100, 1400, 1700, 2000, 2300 (1일 8회)
                        base_time: base_time,
                        // 좌표
                        nx: "55",
                        ny: "124"
                    },
                    success: function (result) {
                        let time = result.response.body.items.item[0].baseTime;
                        let tmp = result.response.body.items.item[0].fcstValue;
                        tmps.push({
                            time,
                            tmp
                        });
                        // 오름차순 정렬
                        tmps.sort(function (a, b) {
                            return a.time - b.time;
                        })

                                // Load the Visualization API and the corechart package.
        google.charts.load('current', {
            'packages': ['corechart']
        });

        // Set a callback to run when the Google Visualization API is loaded.
        google.charts.setOnLoadCallback(drawChart);

        // Callback that creates and populates a data table,
        // instantiates the pie chart, passes in the data and
        // draws it.
        function drawChart() {

            // Create the data table.
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Topping');
            data.addColumn('number', 'Slices');
            data.addRows([
                [tmps[0].time, Number(tmps[0].tmp)]
                [tmps[1].time, Number(tmps[1].tmp)]
                [tmps[2].time, Number(tmps[2].tmp)]
                [tmps[3].time, Number(tmps[3].tmp)]
                [tmps[4].time, Number(tmps[4].tmp)]
                [tmps[5].time, Number(tmps[5].tmp)]
                [tmps[6].time, Number(tmps[6].tmp)]
                [tmps[7].time, Number(tmps[7].tmp)]
            ]);

            // Set chart options
            var options = {
                'title': '날씨',
                'width': 400,
                'height': 300
            };

            // Instantiate and draw our chart, passing in some options.
            var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
            chart.draw(data, options);
        }
                    },
                    error: function (e) {}
                })
            }
        })

    </script>

</body>

</html>